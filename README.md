## Тестовое на позицию junior python разработчик

API, симулирующее работу с виртуальными кошельками пользователей. Стек: FastAPI + SQLAlchemy + PostgreSQL + Docker.

Для запуска достаточно клонировать этот git-репозиторий и запустить docker-контейнер:
```
git clone https://github.com/serpens2/test_task2.git
cd test_task2
docker-compose up --build
```
После чего API будет доступно по адресу `{IP/домен сервера}`:8000/docs.

Для запуска вне docker-контейнера в .env файле поменять `DB_HOST` на 'localhost', установить зависимости
```
pip install -r requirements.txt
```
после чего из директории приложения выполнить:
```
uvicorn main:app
```
Приложение будет работать на localhost:8000/docs. 

Для выхода из приложения нажать `ctrl + C` в командной строке.

## Пояснения
1. В базу данных включёны админ с логином (email) 'admin' и паролем 'admin', а также тестовый пользователь с логином 'my_email@mail.ru' и паролем 'qwerty'.
2. Эмуляция обработки вебхука от сторонней системы реализована следующим образом: авторизованный пользователь отправляет GET-запрос
на `\top_up`, после чего в фоновом режиме выполняется функция `simulate_webhook`, которая ждёт 2-7 секунд, после чего отправляет
json с указанной в задании структурой на `\webhook` (POST-запрос), завершая транзакцию.
3. .env файл включён в проект для удобства проверки. В реальных проектах, конечно, он никогда не включается.
4. "Обновление" пользователя администратором не реализовано, т.к. не понятно, что имеется ввиду
(обнулить кошельки с удалением всех транзакций, связанных с кошельками; обнуление кошельков без удаления транзакций; удаление всех кошельков пользователя с удалением транзакций;
удаление всех кошельков без удаления транзакций).
5. Для авторизации через эндпоинт `\login` ввести логин и пароль, после чего выданный JWT-токен вставить в окно Authorize в верхнем правом углу:
<img width="1233" height="883" alt="image" src="https://github.com/user-attachments/assets/39fb8e63-1576-42dd-ac5b-94e81aa6db69" />
<img width="573" height="249" alt="image" src="https://github.com/user-attachments/assets/67743404-cb1e-4d21-a168-708b4da351a6" />

## Список эндпоинтов
- `/login`: авторизует пользователя через JWT-токен.
- `/create_bank_account`: создаёт новый виртуальный кошелёк для авторизованного пользователя.
- `/top_up`: симулирует пополнение выбранного пользователем кошелька через стороннюю платёжную систему.
- `/webhook`: этот эндпоинт ожидает подтверждения от сторонней платёжной системы для завершения транзакции.
- `/admin/create_user`: позволяет (авторизованному) админу создать нового пользователя.
- `/admin/delete_user/{user_id}`: позволяет админу удалить выбранного пользователя.
- `/admin/get_users`: позволяет админу получить список всех пользователей с их кошельками и балансом каждого кошелька.
- `/me`: выводит информацию об авторизованном пользователе (id + email + имя + роль).
- `/my_bank_accounts`: выводит информацию о кошельках авторизованного пользователя (id + баланс).
- `/my_transactions`: выводит информацию о транзакциях пользователя (id транзакции + id кошелька + сумма + время).

## Структура базы данных
База данных разбита на три таблицы:
- `user` с полями `id`, `email`, `password_hash`, `full_name` и `role`. Роль принимает значения 'user' и 'admin', email при подстановке валидируется через Pydantic.
- `accounts` с полями `id`, `user_id`, `amount`.
- `transactions` с полями `id`, `account_id`, `amount`, `time`.
